# ⚡ 컴포넌트 실행 프로세스

## 실행 과정

!!! info "실행 과정"
    컴포넌트 실행은 다음 순서로 진행됩니다.

```mermaid
flowchart LR
    A[1. DB에서 스크립트 조회] --> B[2. Agent로 전송]
    B --> C[3. 스크립트 파일 생성]
    C --> D[4. 스크립트 실행]
    D --> E[5. 스크립트 파일 삭제]
```

### 상세 과정

1. **스크립트 전송**: DB에 저장된 스크립트를 Agent를 통해 해당 서버에 전송
2. **파일 생성**: 임의의 스크립트 파일 생성
3. **스크립트 실행**: 생성된 스크립트 실행
4. **파일 삭제**: 실행 완료 후 스크립트 파일 삭제

---

## ⚠️ 유의사항

!!! danger "중요: 컴포넌트 인자값 설정 주의"
    **컴포넌트 인자값에 실행할 스크립트에서 확인하는 인자값을 넣지 말 것**

### 잘못된 예시

| 항목 | 내용 |
|:---|:---|
| 스크립트 내용 | `ps -ef \| grep monitoring.jar` |
| 컴포넌트 인자값 | `monitoring.jar` |
| **결과** | 스크립트가 인자값을 grep하여 이미 실행 중인 것으로 착각 |
| **문제** | 실행되지 않았는데도 실행된 것으로 판단하여 실제 실행 안됨 |

### 문제 상황 코드

```bash
# 잘못된 사용 예시

# 스크립트 내용
ps -ef | grep $1  # 인자값을 grep으로 검색

# 컴포넌트 인자값
monitoring.jar

# 실행 시 문제
# grep monitoring.jar 명령 자체가 프로세스에 나타나
# 실제로 실행 중이지 않아도 실행 중인 것으로 판단됨
```

---

## ✅ 올바른 방법

!!! success "올바른 방법"
    스크립트 내부에서 직접 프로세스명을 하드코딩하거나,
    인자값을 사용하는 경우 `grep -v grep`을 함께 사용

### 해결 방법 1: 프로세스명 하드코딩

```bash
#!/bin/bash
# 프로세스명을 직접 스크립트에 작성
ps -ef | grep "monitoring.jar" | grep -v grep
```

### 해결 방법 2: grep -v grep 사용

```bash
#!/bin/bash
# grep -v grep으로 grep 프로세스 자체를 제외
ps -ef | grep "$1" | grep -v grep
```

### 해결 방법 3: pgrep 사용

```bash
#!/bin/bash
# pgrep 명령어 사용 (grep 문제 회피)
pgrep -f "$1"
```

---

## 체크리스트

!!! tip "스크립트 작성 전 확인사항"
    - [ ] exit code가 올바르게 반환되는가?
    - [ ] 인자값이 grep 검색에 영향을 주지 않는가?
    - [ ] 타임아웃 처리가 되어 있는가?
    - [ ] 로그가 적절하게 남는가?
