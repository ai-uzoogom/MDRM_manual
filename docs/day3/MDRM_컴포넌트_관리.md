# 📦 컴포넌트 관리

!!! info "관리를 위한 컴포넌트 구성"
    MDRM의 자동화 작업 단위인 컴포넌트는 재사용성과 안정성을 높이기 위해 표준화된 템플릿 구조를 가집니다.

## **1. 컴포넌트 템플릿 구조**

컴포넌트 템플릿 스크립트는 일반적으로 다음의 3단계 흐름으로 설계하여 운영 안정성을 확보합니다.

| 단계 | 이름 | 설명 |
|:---:|:---|:---|
| 1 | :material-check-circle: **Pre-check** | 명령어 실행 전 환경 및 프로세스 상태 사전 검증 |
| 2 | :material-play-circle: **Execute** | 실제 자동화 작업(시작, 정지, 배포 등) 수행 |
| 3 | :material-check-circle-outline: **Post-check** | 작업 수행 후 최종 결과 및 서비스 가용성 검증 |

---

## **2. 템플릿 생성 및 실행 규칙**

MDRM 워크플로우 엔진이 작업의 성공 여부를 정확히 판단할 수 있도록 아래의 규칙을 반드시 준수해야 합니다.

### **Exit Code 정의**
스크립트의 마지막 **Exit Code**가 해당 작업의 최종 결과를 결정합니다.

| Exit Code | 결과 판정 | 비고 |
|:---:|:---|:---|
| **`0`** | ✅ **성공 (Success)** | 대부분의 표준 명령어는 정상 수행 시 0을 반환합니다. |
| **`그 외`** | ❌ **실패 (Failure)** | 0이 아닌 숫자가 반환되면 워크플로우는 중단됩니다. |

### **특수 상황 처리 (예시)**
일부 솔루션의 경우, 프로세스는 정상 기동되었으나 내부 설정 문제로 특정 코드를 반환하는 경우가 있습니다.
*   **WAS 예시**: 애플리케이션 기동은 성공했으나 DB 접속 실패 시 `98` 반환
*   이런 경우 스크립트 내부 조건문을 통해 최종적으로 `exit 0`을 반환하도록 예외 처리가 필요합니다.

---

## **3. 사용자 정의 방식**

MDRM은 엔지니어의 편의를 위해 두 가지 방식의 컴포넌트 정의를 지원합니다.

*   **단일 명령어 (Single Command)**: 간단한 로그 확인이나 서비스 상태 체크 시 사용합니다.
*   **사용자 스크립트 (User Script)**: 복잡한 비즈니스 로직이나 다단계 프로세스 제어가 필요한 경우 쉘 스크립트 형태로 작성합니다.

---

## **4. 템플릿 작성 가이드 (Best Practice)**

표준적인 컴포넌트 스크립트의 구성 예시입니다.

```bash
#!/bin/bash

# ==========================================
# 1. Pre-check: 사전 환경 검증
# ==========================================
echo "[INFO] 사전 검증을 시작합니다."
# 예: 권한 확인, 기존 프로세스 중복 여부 확인 등

# ==========================================
# 2. Execute: 실제 작업 수행
# ==========================================
echo "[INFO] 기동 명령을 수행합니다."
# 실제 명령어 실행

# ==========================================
# 3. Post-check: 사후 상태 확인
# ==========================================
echo "[INFO] 실행 결과를 확인합니다."
# 예: 포트 리스닝 확인, 로그 내 특정 키워드 검색 등

# 최종 성공 반환
exit 0
```

!!! tip "작성 팁"
    *   단계마다 명확한 로그 메시지를 출력하면 트러블슈팅이 쉬워집니다.
    *   예상치 못한 에러가 발생할 경우 `exit 1` 등으로 즉시 실패를 알려야 합니다.

---

<div class="next-step-card-container" markdown>
<a href="../MDRM_컴포넌트_실행_프로세스/" class="next-step-card">
    <span class="next-content">
        <span class="next-step-label">Next Step</span>
        <span class="next-step-title">⚡ 컴포넌트 실행 프로세스</span>
    </span>
    <span class="next-step-icon">→</span>
</a>
</div>
