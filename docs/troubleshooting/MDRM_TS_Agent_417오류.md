# 📡 MDRM 417 오류 및 Agent Token 불일치 해결 가이드

!!! info "통신 장애 점검 목적"
    MDRM 서버와 관리 대상 서버(Agent) 간에 정상적으로 통신이 이루어지지 않을 때 나타나는 417 오류 및 'token not match' 현상의 원인과 해결 방법을 안내합니다.

| 현상 구분 | 표시 메시지 |
|:---|:---|
| **MDRM 서버 측** | "417 오류 발생" |
| **Agent 서버 측** | "token not match!" |

---

## **1. 주요 발생 위치**

통신 오류는 주로 다음 세 가지 상황에서 확인할 수 있습니다.

1.  **연결 테스트**: [시스템] > [계정] 메뉴에서 연결 테스트 시 실패
2.  **로그 확인**: Agent 설치 경로의 `/opt/gam_agent/logs/gam_agent.log` 파일 내 기록
3.  **컴포넌트 실행**: 작업 수행 후 반환되는 결과값에서 오류 확인

---

## **2. 체크리스트 및 해결 방법**

### **① 보안 프로그램 및 방화벽 설정 확인 (우선 확인)**
가장 빈번한 원인인 만큼 반드시 먼저 확인해야 합니다.

*   보안 프로그램이나 네트워크 방화벽 설정으로 인해 MDRM과 Agent 간의 특정 포트 통신이 차단되어 있는지 확인합니다.
*   양방향 `ping` 테스트를 통해 기본적인 네트워크 연결성을 먼저 체크합니다.

### **② 중복 노드 여부 확인 (가장 빈번한 원인)**
**[중요]** 보안 프로그램 이슈와 더불어 가장 빈번하게 발생하는 통신 오류의 원인입니다. Agent 서버를 복제하여 생성하거나 설정 파일을 재사용할 때 특히 주의해야 합니다.

*   **Agent 설정 확인**: `<AGENT_HOME>/application.properties` 파일 내 `node_id` 값이 고유(Unique)한지 확인합니다.
*   **MDRM Admin 확인**: 문제가 되는 Agent 서비스를 끄고, MDRM 관리 페이지의 [노드 관리]에서 해당 노드의 상태를 확인합니다. `UNKNOWN`이 아닌 다른 상태라면 이미 다른 서버가 해당 ID로 연결되어 있는 중복 노드 상태임을 의미합니다.

### **③ Java 프로세스 중복 동작 여부**

*   **현상**: 구버전(1.3.0 이전)에서 `agent.jar` 프로세스가 2개 이상 구동되어 서로 다른 토큰으로 통신을 시도하는 경우가 있습니다.
*   **해결**: 실행 중인 모든 agent 프로세스를 종료(`kill`)한 후 서비스를 재시작합니다.

### **④ Java 버전 확인**

*   Agent가 사용하는 Java 버전이 너무 낮거나 특정 마이너 버전의 버그가 있을 수 있습니다. 최신 버전으로 업데이트를 권장합니다.

### **⑤ Agent 서버의 CPU 과점유 (100%)**

*   CPU 사용량이 100%에 근접하면 Health Check 시 `Read timed out`이 발생하며 Agent가 강제 재시작될 수 있습니다.
*   이 과정에서 통신이 끊어지면 417 오류가 발생할 수 있으므로, 컴포넌트 속성에서 **'재시도 횟수'**를 설정하여 일시적인 부하에 대비합니다.

### **⑥ 서버 시간(Timezone) 불일치**

*   MDRM 서버와 Agent 서버의 시스템 시간이 크게 다를 경우 토큰 인증이 실패할 수 있습니다. 양 서버의 시간대를 동기화하십시오.

---

<div class="next-step-card-container" markdown>
<a href="../MDRM_TS_Agent_포트변경/" class="next-step-card">
    <span class="next-content">
        <span class="next-step-label">Troubleshooting 04</span>
        <span class="next-step-title">Agent 포트(20080) 변경</span>
    </span>
    <span class="next-step-icon">→</span>
</a>
</div>
